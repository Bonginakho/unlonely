<!DOCTYPE html>
<html>
  <head>
    <title>Unlonely</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_include_tag 'custom', 'data-turbolinks-track': 'reload' %>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      .modal-content {
          background-color: black;
          color: white;
          border: 1px solid rgba(255, 255, 255, 0.2);
      }
      .modal-header {
          border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      .btn-close {
          filter: invert(1);
      }
      .btn-light {
        font-size: 30px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <%= render "shared/navbar" %>
    <%= render "shared/flashes" %>
    <p class="notice"><%= notice %></p>
    <p class="alert"><%= alert %></p>
    <%= yield %>
    <div class="modal fade" id="exampleModalToggle" aria-hidden="true" aria-labelledby="exampleModalToggleLabel" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalToggleLabel">Weekly Ritual</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Show a second modal and hide this one with the button below.
          </div>
          <div class="modal-footer">
            <button class="btn btn-light" data-bs-target="#exampleModalToggle2" data-bs-toggle="modal">Process</button>
            <button class="btn btn-light" data-bs-target="#exampleModalToggle3" data-bs-toggle="modal">Alignment</button>
            <button class="btn btn-light" data-bs-target="#exampleModalToggle4" data-bs-toggle="modal">Clarity</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="exampleModalToggle2" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalToggleLabel2">Process</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>What is true about what I am feeling?</p>
            <p>What actions are within my control?</p>
            <div class="modal-body">
              <p>Write your diary entry below:</p>
              <form id="diaryForm">
                <div class="mb-3">
                  <label for="diaryInput" class="form-label">Your Entry</label>
                  <textarea class="form-control" id="diaryInput" rows="3" placeholder="Type your diary entry..." required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Save Entry</button>
              </form>
              <hr>
              <h5>Previous Entries:</h5>
              <ul id="entryList" class="list-group">
                <!-- Old entries will be appended here -->
              </ul>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-light" data-bs-target="#exampleModalToggle" data-bs-toggle="modal">Back to first</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="exampleModalToggle3" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalToggleLabel2">Alignment</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>How do I let the truth of what I am feeling, having let go of what is outside of my control, lead me today?</p>
            <p>These are the steps I will bring me into alignment with what I want:</p>
            <div class="modal-body">
              <p>Write your diary entry below:</p>
              <form id="diaryForm">
                <div class="mb-3">
                  <label for="diaryInput" class="form-label">Your Entry</label>
                  <textarea class="form-control" id="diaryInput" rows="3" placeholder="Type your diary entry..." required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Save Entry</button>
              </form>
              <hr>
              <h5>Previous Entries:</h5>
              <ul id="entryList" class="list-group">
                <!-- Old entries will be appended here -->
              </ul>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-light" data-bs-target="#exampleModalToggle" data-bs-toggle="modal">Back to first</button>
          </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="exampleModalToggle4" aria-hidden="true" aria-labelledby="exampleModalToggleLabel2" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalToggleLabel2">Clarity</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>What is in my mind?</p>
            <p>Don't overthink here.Just write down whatever is in your mind as you start your morning.Whatever you're into.
            Don't judge it.Just let whatever comes up make its way onto the page.</p>
            <div class="modal-body">
              <p>Write your diary entry below:</p>
              <form id="diaryForm">
                <div class="mb-3">
                  <label for="diaryInput" class="form-label">Your Entry</label>
                  <textarea class="form-control" id="diaryInput" rows="3" placeholder="Type your diary entry..." required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Save Entry</button>
              </form>
              <hr>
              <h5>Previous Entries:</h5>
              <ul id="entryList" class="list-group">
                <!-- Old entries will be appended here -->
              </ul>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-light" data-bs-target="#exampleModalToggle" data-bs-toggle="modal">Back to first</button>
          </div>
        </div>
      </div>
    </div>
    <button class="btn btn-light" data-bs-target="#exampleModalToggle" data-bs-toggle="modal">weekly Ritual</button>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <script>
      let currentEditIndex = null;

      // Load previous entries from local storage
      document.addEventListener('DOMContentLoaded', function() {
        loadEntries();
      });

      function loadEntries() {
        const entries = JSON.parse(localStorage.getItem('diaryEntries')) || [];
        const entryList = document.getElementById('entryList');
        entryList.innerHTML = ''; // Clear the list before loading
        entries.forEach((entry, index) => {
          const li = document.createElement('li');
          li.className = 'list-group-item d-flex justify-content-between align-items-center';
          li.textContent = entry;

          // Edit button
          const editButton = document.createElement('button');
          editButton.className = 'btn btn-warning btn-sm';
          editButton.textContent = 'Edit';
          editButton.onclick = () => editEntry(index);
          li.appendChild(editButton);

          // Delete button
          const deleteButton = document.createElement('button');
          deleteButton.className = 'btn btn-danger btn-sm';
          deleteButton.textContent = 'Delete';
          deleteButton.onclick = () => deleteEntry(index);
          li.appendChild(deleteButton);

          entryList.appendChild(li);
        });
      }

      // Handle form submission
      document.getElementById('diaryForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent the default form submission
        const diaryText = document.getElementById('diaryInput').value;

        const entries = JSON.parse(localStorage.getItem('diaryEntries')) || [];
        if (currentEditIndex !== null) {
          // Update existing entry
          entries[currentEditIndex] = diaryText;
          currentEditIndex = null; // Reset edit index
        } else {
          // Add new entry
          entries.push(diaryText);
        }
        localStorage.setItem('diaryEntries', JSON.stringify(entries));
        loadEntries(); // Refresh the entry list
        document.getElementById('diaryInput').value = ''; // Clear the input field
      });

      function editEntry(index) {
        const entries = JSON.parse(localStorage.getItem('diaryEntries')) || [];
        document.getElementById('diaryInput').value = entries[index]; // Populate input for editing
        currentEditIndex = index; // Set the current edit index
      }

      function deleteEntry(index) {
        const entries = JSON.parse(localStorage.getItem('diaryEntries')) || [];
        entries.splice(index, 1); // Remove the entry from the array
        localStorage.setItem('diaryEntries', JSON.stringify(entries)); // Update local storage
        loadEntries(); // Refresh the entry list
      }
    </script>
  </body>
</html>
